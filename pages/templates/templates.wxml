<!--templates.wxml-->
<view class="container">
  <!-- 搜索栏 -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <input 
        class="search-input" 
        placeholder="搜索模板" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearch"
      />
      <text class="search-icon">🔍</text>
    </view>
  </view>

  <!-- 分类标签 -->
  <scroll-view class="category-tabs" scroll-x="true">
    <view class="tab-item {{currentCategory === item.id ? 'active' : ''}}" 
          wx:for="{{categories}}" 
          wx:key="id"
          bindtap="selectCategory"
          data-id="{{item.id}}">
      <text class="tab-text">{{item.name}}</text>
    </view>
  </scroll-view>

  <!-- 模板网格 -->
  <scroll-view class="template-grid" scroll-y="true" enhanced="true" show-scrollbar="false">
    <view class="grid-container">
      <view class="template-card" 
            wx:for="{{filteredTemplates}}" 
            wx:key="id"
            bindtap="selectTemplate"
            data-template="{{item}}">
        
        <!-- 模板预览 -->
        <view class="template-preview">
          <view class="preview-container" style="{{item.containerStyle}}">
            <view class="preview-cell" 
                  wx:for="{{item.cells}}" 
                  wx:for-item="cell" 
                  wx:key="cellIndex"
                  style="{{cell.style}}">
              <view class="cell-placeholder"></view>
            </view>
          </view>
          
          <!-- 选中标识 -->
          <view class="selected-mark" wx:if="{{selectedTemplate && selectedTemplate.id === item.id}}">
            <text class="check-icon">✓</text>
          </view>
        </view>
        
        <!-- 模板信息 -->
        <view class="template-info">
          <text class="template-name">{{item.name}}</text>
          <view class="template-meta">
            <text class="photo-count">{{item.photoCount}}张照片</text>
            <text class="template-tag">{{item.tag}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 加载更多 -->
    <view class="load-more" wx:if="{{hasMore}}">
      <text class="load-text">加载更多模板...</text>
    </view>
  </scroll-view>

  <!-- 底部操作栏 -->
  <view class="bottom-actions">
    <button class="action-btn secondary" bindtap="previewTemplate">
      预览
    </button>
    <button class="action-btn primary" bindtap="useTemplate" disabled="{{!selectedTemplate}}">
      使用模板
    </button>
  </view>

  <!-- 预览模态框 -->
  <view class="preview-modal {{showPreview ? 'show' : ''}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">模板预览</text>
        <text class="close-btn" bindtap="closePreview">×</text>
      </view>
      
      <view class="preview-detail" wx:if="{{selectedTemplate}}">
        <view class="large-preview">
          <view class="preview-container large" style="{{selectedTemplate.containerStyle}}">
            <view class="preview-cell" 
                  wx:for="{{selectedTemplate.cells}}" 
                  wx:for-item="cell" 
                  wx:key="cellIndex"
                  style="{{cell.style}}">
              <view class="cell-placeholder"></view>
            </view>
          </view>
        </view>
        
        <view class="template-details">
          <text class="detail-title">{{selectedTemplate.name}}</text>
          <text class="detail-desc">{{selectedTemplate.description}}</text>
          <view class="detail-specs">
            <view class="spec-item">
              <text class="spec-label">照片数量:</text>
              <text class="spec-value">{{selectedTemplate.photoCount}}</text>
            </view>
            <view class="spec-item">
              <text class="spec-label">适用场景:</text>
              <text class="spec-value">{{selectedTemplate.scene}}</text>
            </view>
            <view class="spec-item">
              <text class="spec-label">推荐比例:</text>
              <text class="spec-value">{{selectedTemplate.ratio}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-actions">
        <button class="modal-btn secondary" bindtap="closePreview">取消</button>
        <button class="modal-btn primary" bindtap="confirmUseTemplate">使用此模板</button>
      </view>
    </view>
  </view>
</view>