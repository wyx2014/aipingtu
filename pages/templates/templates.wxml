<!--templates.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <input 
        class="search-input" 
        placeholder="æœç´¢æ¨¡æ¿" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearch"
      />
      <text class="search-icon">ğŸ”</text>
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <scroll-view class="category-tabs" scroll-x="true">
    <view class="tab-item {{currentCategory === item.id ? 'active' : ''}}" 
          wx:for="{{categories}}" 
          wx:key="id"
          bindtap="selectCategory"
          data-id="{{item.id}}">
      <text class="tab-text">{{item.name}}</text>
    </view>
  </scroll-view>

  <!-- æ¨¡æ¿ç½‘æ ¼ -->
  <scroll-view class="template-grid" scroll-y="true" enhanced="true" show-scrollbar="false">
    <view class="grid-container">
      <view class="template-card" 
            wx:for="{{filteredTemplates}}" 
            wx:key="id"
            bindtap="selectTemplate"
            data-template="{{item}}">
        
        <!-- æ¨¡æ¿é¢„è§ˆ -->
        <view class="template-preview">
          <view class="preview-container" style="{{item.containerStyle}}">
            <view class="preview-cell" 
                  wx:for="{{item.cells}}" 
                  wx:for-item="cell" 
                  wx:key="cellIndex"
                  style="{{cell.style}}">
              <view class="cell-placeholder"></view>
            </view>
          </view>
          
          <!-- é€‰ä¸­æ ‡è¯† -->
          <view class="selected-mark" wx:if="{{selectedTemplate && selectedTemplate.id === item.id}}">
            <text class="check-icon">âœ“</text>
          </view>
        </view>
        
        <!-- æ¨¡æ¿ä¿¡æ¯ -->
        <view class="template-info">
          <text class="template-name">{{item.name}}</text>
          <view class="template-meta">
            <text class="photo-count">{{item.photoCount}}å¼ ç…§ç‰‡</text>
            <text class="template-tag">{{item.tag}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore}}">
      <text class="load-text">åŠ è½½æ›´å¤šæ¨¡æ¿...</text>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn secondary" bindtap="previewTemplate">
      é¢„è§ˆ
    </button>
    <button class="action-btn primary" bindtap="useTemplate" disabled="{{!selectedTemplate}}">
      ä½¿ç”¨æ¨¡æ¿
    </button>
  </view>

  <!-- é¢„è§ˆæ¨¡æ€æ¡† -->
  <view class="preview-modal {{showPreview ? 'show' : ''}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æ¨¡æ¿é¢„è§ˆ</text>
        <text class="close-btn" bindtap="closePreview">Ã—</text>
      </view>
      
      <view class="preview-detail" wx:if="{{selectedTemplate}}">
        <view class="large-preview">
          <view class="preview-container large" style="{{selectedTemplate.containerStyle}}">
            <view class="preview-cell" 
                  wx:for="{{selectedTemplate.cells}}" 
                  wx:for-item="cell" 
                  wx:key="cellIndex"
                  style="{{cell.style}}">
              <view class="cell-placeholder"></view>
            </view>
          </view>
        </view>
        
        <view class="template-details">
          <text class="detail-title">{{selectedTemplate.name}}</text>
          <text class="detail-desc">{{selectedTemplate.description}}</text>
          <view class="detail-specs">
            <view class="spec-item">
              <text class="spec-label">ç…§ç‰‡æ•°é‡:</text>
              <text class="spec-value">{{selectedTemplate.photoCount}}</text>
            </view>
            <view class="spec-item">
              <text class="spec-label">é€‚ç”¨åœºæ™¯:</text>
              <text class="spec-value">{{selectedTemplate.scene}}</text>
            </view>
            <view class="spec-item">
              <text class="spec-label">æ¨èæ¯”ä¾‹:</text>
              <text class="spec-value">{{selectedTemplate.ratio}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-actions">
        <button class="modal-btn secondary" bindtap="closePreview">å–æ¶ˆ</button>
        <button class="modal-btn primary" bindtap="confirmUseTemplate">ä½¿ç”¨æ­¤æ¨¡æ¿</button>
      </view>
    </view>
  </view>
</view>